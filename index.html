<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ðŸ“œ Trip Ledger - Bankin' Style</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap');
    :root { --bg-cream: #f1ede4; --main-brown: #6d5d51; --accent-tan: #d9cfc1; --soft-white: rgba(255, 255, 255, 0.9); }
    body { background-color: var(--bg-cream); font-family: 'Inter', sans-serif; color: var(--main-brown); -webkit-font-smoothing: antialiased; scroll-behavior: smooth; }
    .serif { font-family: 'Playfair Display', serif; }
    .app-card { background: var(--soft-white); border-radius: 28px; box-shadow: 0 4px 20px rgba(109, 93, 81, 0.08); border: 1px solid rgba(255, 255, 255, 0.5); }
    .settled { opacity: 0.3; text-decoration: line-through; filter: grayscale(1); }
    .custom-scroll::-webkit-scrollbar { height: 0px; width: 0px; } 
    input[type="text"], input[type="number"], select { background: #ffffff; outline: none; border-radius: 20px; font-size: 16px !important; padding: 14px 18px; width: 100%; border: 1px solid transparent; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); text-align: center; text-align-last: center; }
    input[type="date"] { background: #ffffff; border-radius: 16px; padding: 10px 8px; font-size: 13px !important; color: var(--main-brown); width: 100%; border: none; display: block; box-sizing: border-box; }
    #tripName { background: transparent; border: none; font-size: 28px !important; padding: 0; box-shadow: none; text-align: left; }
    .btn-primary { background-color: var(--main-brown); color: white; padding: 16px; border-radius: 20px; font-size: 14px; font-weight: bold; width: 100%; transition: opacity 0.2s; }
    .trip-tab { background: var(--accent-tan); padding: 10px 24px; border-radius: 20px; font-size: 13px; font-weight: 600; white-space: nowrap; cursor: pointer; color: #8c8279; opacity: 0.6; }
    .trip-tab.active { background: white; color: var(--main-brown); opacity: 1; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--main-brown); border-radius: 8px; }
    .jump-btn { position: fixed; bottom: 30px; right: 30px; width: 56px; height: 56px; background: var(--main-brown); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px rgba(109, 93, 81, 0.3); z-index: 99; font-size: 24px; }
    .pool-box { background: #dfd8cf; border-radius: 28px; }
    /* æ‹–æ‹‰æ™‚çš„è¦–è¦ºæ•ˆæžœ */
    .dragging { opacity: 0.5; transform: scale(0.95); }
    .drop-zone-active { background: rgba(109, 93, 81, 0.1); border-radius: 28px; }
  </style>
</head>
<body class="p-0">

  <div class="jump-btn" onclick="document.getElementById('settlementArea').scrollIntoView()">â†“</div>

  <main class="max-w-md mx-auto min-h-screen flex flex-col">
    <div class="flex overflow-x-auto px-4 py-4 gap-2 custom-scroll">
        <div id="tabContainer" class="flex gap-2"></div>
        <button onclick="addNewTrip()" class="w-10 h-10 flex-shrink-0 bg-white/50 rounded-full font-bold opacity-50">+</button>
    </div>

    <div class="px-6 py-2 space-y-4">
      <input id="tripName" type="text" placeholder="Trip Name..." oninput="saveAll()" class="serif font-bold">
      <div class="flex gap-3 bg-white/40 p-3 rounded-[24px] items-end">
          <div class="flex-1 min-w-0"><p class="text-[9px] font-bold opacity-40 mb-1 ml-3 uppercase tracking-tighter">Start Date</p><input type="date" id="startDate" onchange="saveAll()"></div>
          <div class="flex-1 min-w-0"><p class="text-[9px] font-bold opacity-40 mb-1 ml-3 uppercase tracking-tighter">End Date</p><input type="date" id="endDate" onchange="saveAll()"></div>
      </div>
      <div class="app-card p-4 flex items-center justify-between">
          <div class="flex items-center gap-2"><span class="text-[10px] font-bold uppercase opacity-50">1 HKD =</span><select id="targetCurr" onchange="handleCurrChange()" class="!w-20 !p-1 !rounded-lg !text-xs font-bold bg-transparent"><option value="JPY">JPY</option><option value="KRW">KRW</option><option value="USD">USD</option><option value="TWD">TWD</option></select></div>
          <input id="currentRateVal" type="number" step="0.001" onchange="saveAll()" class="!w-24 !p-1 !bg-transparent text-right font-bold text-lg">
          <button onclick="fetchLiveRate()" class="text-[9px] bg-white px-3 py-2 rounded-full font-bold shadow-sm">Live</button>
      </div>
    </div>

    <div class="flex-1 p-6 space-y-8">
        <div class="flex justify-between items-center bg-white/30 p-2 rounded-full">
            <div id="memberList" class="flex flex-wrap gap-2 px-2"></div>
            <button onclick="addMember()" class="w-10 h-10 bg-white rounded-full text-lg shadow-sm">+</button>
        </div>
        <section class="pool-box p-6 shadow-inner">
            <div class="flex justify-between items-start mb-4">
                <div><p class="text-[10px] font-bold opacity-60 uppercase tracking-widest mb-1">Common Pool (<span class="target-curr-label">---</span>)</p><div id="commonPoolInfo" class="text-4xl font-bold tracking-tighter">0</div></div>
                <button onclick="openDepositModal()" class="bg-white px-4 py-2 rounded-xl text-[10px] font-bold shadow-sm">TOP UP</button>
            </div>
            <div id="depositList" class="space-y-2"></div>
        </section>
        <section class="space-y-3" ondragover="event.preventDefault(); this.classList.add('drop-zone-active')" ondragleave="this.classList.remove('drop-zone-active')" ondrop="handleDrop(event, 'PRE')">
            <div class="flex justify-between items-center"><p class="serif text-xl font-bold">Pre-Trip</p><button onclick="openModal('PRE')" class="text-[10px] font-bold bg-white/80 px-4 py-2 rounded-full">+ Add</button></div>
            <div id="preTripContainer" class="space-y-3"></div>
        </section>
        <div id="timelineContainer" class="space-y-8"></div>
        <section id="settlementArea" class="mt-8 pt-8">
            <div class="app-card p-6 space-y-6">
                <h3 class="serif text-2xl text-center font-bold">Settlement</h3>
                <div class="overflow-hidden rounded-2xl border border-gray-100 bg-white/50">
                    <table class="w-full text-left text-[11px]">
                        <thead class="bg-gray-50/50 font-bold opacity-50"><tr><th class="p-3">NAME</th><th class="p-3 text-right">PAID(HK)</th><th class="p-3 text-right">PAID(<span class="target-curr-label">--</span>)</th><th class="p-3 text-right">NET</th></tr></thead>
                        <tbody id="calculationTable" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
                <div id="transferList" class="space-y-3"></div>
                <button onclick="copySummary()" class="btn-primary shadow-lg uppercase tracking-widest">Copy Report</button>
                <div class="flex flex-col gap-2 pt-2">
                    <button onclick="deleteCurrentTrip()" class="w-full text-[10px] opacity-40 font-bold">DELETE TRIP</button>
                    <button onclick="resetAllData()" class="w-full text-[10px] text-red-400 opacity-60 font-bold">RESET ALL DATA</button>
                </div>
            </div>
        </section>
        <div class="h-20"></div>
    </div>
  </main>

  <div id="modal" class="hidden fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-end">
    <div class="bg-[#f1ede4] w-full rounded-t-[40px] p-8 shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="w-12 h-1.5 bg-gray-300 mx-auto mb-8 rounded-full"></div>
        <h3 id="modalTitle" class="serif text-2xl mb-8 text-center font-bold">Record</h3>
        <input type="hidden" id="exDate"><input type="hidden" id="exId"> 
        <div class="space-y-6">
            <div><p class="text-[10px] font-bold opacity-40 mb-2 uppercase ml-2">Description</p><input id="exDesc" type="text" placeholder="What's this for?"></div>
            <div class="flex gap-4"><div class="flex-1"><p class="text-[10px] font-bold opacity-40 mb-2 uppercase ml-2">Amount</p><input id="exAmt" type="number" inputmode="decimal" placeholder="0.00"></div><div class="w-32"><p class="text-[10px] font-bold opacity-40 mb-2 uppercase ml-2">Currency</p><select id="exCurr"></select></div></div>
            <div id="payerSection" class="space-y-6">
                <div class="flex items-center gap-4 p-5 bg-white/50 rounded-3xl"><input type="checkbox" id="usePool" onchange="togglePoolPayer(this.checked)"><label for="usePool" class="text-sm font-bold">Paid by Common Pool?</label></div>
                <div id="personalPayerFields" class="space-y-6">
                    <div><p class="text-[10px] font-bold opacity-40 mb-2 uppercase ml-2">Payer</p><select id="exPayer"></select></div>
                    <div><p class="text-[10px] font-bold opacity-40 mb-2 uppercase ml-2">Splitees</p><div id="modalSplit" class="grid grid-cols-2 gap-3 bg-white/50 rounded-3xl p-4"></div></div>
                </div>
            </div>
        </div>
        <div class="flex gap-4 mt-10 pb-4"><button onclick="closeModal()" class="flex-1 py-4 text-sm font-bold opacity-40">Close</button><button onclick="saveRecord()" class="flex-1 btn-primary">SAVE</button></div>
    </div>
  </div>

<script>
  // Firebase è¨­å®šä¿æŒä¸è®Š
  const firebaseConfig = { apiKey: "AIzaSyB_ni1Eypuaq1axtilczSo8gjdZk7_Rge4", authDomain: "trip-planner-813fe.firebaseapp.com", databaseURL: "https://trip-planner-813fe-default-rtdb.firebaseio.com", projectId: "trip-planner-813fe", storageBucket: "trip-planner-813fe.firebasestorage.app", messagingSenderId: "606499488470", appId: "1:606499488470:web:e744bc3964fa4a54ae7f77", measurementId: "G-CTQHRMRTK2" };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const dbPath = db.ref('tripLedgerData/trips');

  let trips = [];
  let currentTripId = localStorage.getItem('tripLedger_currentId');
  let state = {};

  dbPath.on('value', (snapshot) => {
    const data = snapshot.val();
    if (data) {
        trips = data;
        if (!currentTripId || !trips.find(t => t.id == currentTripId)) {
            currentTripId = trips[0].id;
            localStorage.setItem('tripLedger_currentId', currentTripId);
        }
        init();
    } else {
        trips = [{ id: Date.now(), name: "New Trip", members: [], expenses: [], poolDeposits: [], targetCurr: 'JPY', rateVal: 19.3 }];
        dbPath.set(trips);
    }
  });

  function init() {
    state = trips.find(t => t.id == currentTripId) || trips[0];
    if(!state.members) state.members = [];
    if(!state.expenses) state.expenses = [];
    if(!state.poolDeposits) state.poolDeposits = [];
    renderTabs(); syncUI();
  }

  function renderTabs() {
    document.getElementById('tabContainer').innerHTML = trips.map(t => 
      `<div onclick="switchTrip(${t.id})" class="trip-tab ${t.id == currentTripId ? 'active' : ''}">${t.name || 'Untitled'}</div>`
    ).join('');
  }

  function switchTrip(id) { currentTripId = id; localStorage.setItem('tripLedger_currentId', id); init(); }

  function saveAll() {
    state.name = document.getElementById('tripName').value;
    state.tripName = state.name;
    state.startDate = document.getElementById('startDate').value;
    state.endDate = document.getElementById('endDate').value;
    state.targetCurr = document.getElementById('targetCurr').value;
    state.rateVal = parseFloat(document.getElementById('currentRateVal').value) || 1;
    const idx = trips.findIndex(t => t.id == currentTripId);
    if (idx !== -1) { trips[idx] = state; dbPath.set(trips); }
    renderTabs(); 
  }

  // --- æ‹–æ‹‰åŠŸèƒ½é‚è¼¯ ---
  function handleDragStart(e, id) {
    e.dataTransfer.setData("text/plain", id);
    e.target.classList.add('dragging');
  }

  function handleDragEnd(e) {
    e.target.classList.remove('dragging');
    document.querySelectorAll('.drop-zone-active').forEach(el => el.classList.remove('drop-zone-active'));
  }

  function handleDrop(e, newDate) {
    e.preventDefault();
    const id = e.dataTransfer.getData("text/plain");
    const exp = state.expenses.find(x => x.id == id);
    if (exp && exp.date !== newDate) {
        exp.date = newDate;
        saveAll(); // è‡ªå‹•å­˜æª”ä¸¦é‡æ–°æ¸²æŸ“
    }
  }
  // ------------------

  function syncUI() {
    document.getElementById('tripName').value = state.name || '';
    document.getElementById('startDate').value = state.startDate || '';
    document.getElementById('endDate').value = state.endDate || '';
    document.getElementById('targetCurr').value = state.targetCurr || 'JPY';
    document.getElementById('currentRateVal').value = state.rateVal || 1;
    document.querySelectorAll('.target-curr-label').forEach(el => el.innerText = state.targetCurr);
    document.getElementById('exCurr').innerHTML = `<option value="HKD">HKD</option><option value="${state.targetCurr}">${state.targetCurr}</option>`;
    document.getElementById('memberList').innerHTML = (state.members || []).map(m => `<div class="bg-white px-4 py-2 rounded-full text-[11px] font-bold shadow-sm flex items-center gap-2">${m}<button onclick="removeMember('${m}')" class="text-red-300">Ã—</button></div>`).join('');
    renderTimeline(); calculateFinancials();
  }

  function renderTimeline() {
    const exps = state.expenses || [];
    const preExps = exps.filter(e => e.date === 'PRE');
    document.getElementById('preTripContainer').innerHTML = preExps.map(e => itemHtml(e)).join('') || '<p class="text-center py-2 text-[11px] opacity-30 italic">No records</p>';
    
    let h = ''; const start = new Date(state.startDate); const end = new Date(state.endDate);
    if (state.startDate && state.endDate && start <= end) {
        let d = new Date(start); let count = 1;
        while (d <= end) {
            const ds = d.toISOString().split('T')[0];
            const dayExps = exps.filter(e => e.date === ds);
            h += `<div class="mb-8" ondragover="event.preventDefault(); this.classList.add('drop-zone-active')" ondragleave="this.classList.remove('drop-zone-active')" ondrop="handleDrop(event, '${ds}')">
                    <div class="flex justify-between items-end mb-4 px-2"><p class="serif text-2xl font-bold">Day ${count}</p><p class="text-[10px] opacity-40 font-bold tracking-widest uppercase">${ds.replace(/-/g, '/')}</p></div>
                    <div class="space-y-4">${dayExps.map(e => itemHtml(e)).join('')}</div>
                    <button onclick="openModal('${ds}')" class="mt-4 text-[11px] font-bold opacity-60 w-full py-4 rounded-[20px] bg-white/60 border border-white/40">+ ADD RECORD</button>
                  </div>`;
            d.setDate(d.getDate() + 1); count++;
        }
    }
    document.getElementById('timelineContainer').innerHTML = h;
  }
  
  function itemHtml(e) {
    return `<div class="app-card p-5 flex justify-between items-center ${e.settled?'settled':''}" 
                 draggable="true" 
                 ondragstart="handleDragStart(event, '${e.id}')" 
                 ondragend="handleDragEnd(event)">
        <div class="flex items-center gap-4"><input type="checkbox" ${e.settled?'checked':''} onchange="toggleSettled('${e.id}')"><div><p class="font-bold text-sm">${e.desc}</p><p class="text-[10px] opacity-60 font-bold uppercase tracking-tight">${e.isPool?'ðŸŸ¡ Pool':e.payer} â€¢ ${e.curr} ${e.amt}</p></div></div>
        <div class="flex items-center gap-3"><button onclick="editExpense('${e.id}')" class="text-blue-400 font-bold text-xs">âœŽ</button><button onclick="deleteExp('${e.id}')" class="text-gray-300 px-2 text-xl">Ã—</button></div></div>`;
  }

  // å…¶é¤˜è¨ˆç®—ã€Modal é‚è¼¯èˆ‡ä¹‹å‰å®Œå…¨ä¸€è‡´ï¼Œä¸å†è´…è¿°
  function calculateFinancials() {
    const members = state.members || [];
    const calc = {}; members.forEach(m => calc[m] = { paidHKD: 0, paidTarget: 0, costHKD: 0 });
    let poolBal = 0; (state.poolDeposits || []).forEach(d => { poolBal += (d.curr === 'HKD' ? d.amt * state.rateVal : d.amt); });
    (state.expenses || []).filter(e => !e.settled).forEach(e => {
        const hk = e.curr === 'HKD' ? e.amt : e.amt / state.rateVal;
        const tg = e.curr === 'HKD' ? e.amt * state.rateVal : e.amt;
        if (e.isPool) poolBal -= tg;
        else {
            if (e.curr === 'HKD') calc[e.payer].paidHKD += e.amt; else calc[e.payer].paidTarget += e.amt;
            const share = hk / (e.splitWith.length || 1);
            e.splitWith.forEach(m => { if(calc[m]) calc[m].costHKD += share; });
        }
    });
    document.getElementById('commonPoolInfo').innerText = Math.round(poolBal).toLocaleString();
    document.getElementById('depositList').innerHTML = (state.poolDeposits || []).map(d => `<div class="text-[9px] bg-white/40 p-2 rounded-xl flex justify-between items-center"><span>+ ${d.curr} ${d.amt}</span><div class="flex items-center gap-2"><button onclick="editDeposit('${d.id}')" class="text-blue-400 font-bold px-1">âœŽ</button><button onclick="deleteDeposit(${d.id})" class="text-red-300 px-2">Ã—</button></div></div>`).join('');
    document.getElementById('calculationTable').innerHTML = members.map(m => {
        const net = (calc[m].paidHKD + (calc[m].paidTarget / state.rateVal)) - calc[m].costHKD;
        return `<tr><td class="p-4 font-bold">${m}</td><td class="p-4 text-right opacity-60">${calc[m].paidHKD.toFixed(0)}</td><td class="p-4 text-right opacity-60">${calc[m].paidTarget.toFixed(0)}</td><td class="p-4 text-right font-bold ${net>=0?'text-green-700':'text-red-700'}">${net>0?'+':''}${net.toFixed(0)}</td></tr>`;
    }).join('');
    let netA = members.map(m => ({ name: m, bal: (calc[m].paidHKD + (calc[m].paidTarget / state.rateVal)) - calc[m].costHKD }));
    let cr = netA.filter(x => x.bal > 0.5).sort((a,b) => b.bal - a.bal);
    let db = netA.filter(x => x.bal < -0.5).sort((a,b) => a.bal - b.bal);
    let tHtml = '';
    while(db.length && cr.length) {
        let amt = Math.min(Math.abs(db[0].bal), cr[0].bal);
        tHtml += `<div class="p-4 bg-white rounded-[20px] flex justify-between items-center shadow-sm text-xs"><span><b>${db[0].name}</b> âž” <b>${cr[0].name}</b></span><span class="font-bold text-red-700">HKD ${Math.round(amt)}</span></div>`;
        db[0].bal += amt; cr[0].bal -= amt;
        if (Math.abs(db[0].bal) < 0.5) db.shift(); if (cr[0].bal < 0.5) cr.shift();
    }
    document.getElementById('transferList').innerHTML = tHtml || '<p class="text-center py-4 opacity-20 italic">Settled</p>';
  }

  function openModal(date) { const isD = (date === 'DEPOSIT'); document.getElementById('modalTitle').innerText = isD ? 'Deposit Pool' : 'Record'; document.getElementById('exDate').value = date || 'PRE'; document.getElementById('exId').value = ''; document.getElementById('exDesc').parentElement.classList.toggle('hidden', isD); document.getElementById('payerSection').classList.toggle('hidden', isD); document.getElementById('modal').classList.remove('hidden'); document.getElementById('exDesc').value = ''; document.getElementById('exAmt').value = ''; togglePoolPayer(false); }
  function editExpense(id) { const e = state.expenses.find(x => x.id == id); if (!e) return; openModal(e.date); document.getElementById('exId').value = e.id; document.getElementById('exDesc').value = e.desc; document.getElementById('exAmt').value = e.amt; document.getElementById('exCurr').value = e.curr; document.getElementById('usePool').checked = e.isPool; togglePoolPayer(e.isPool); if (!e.isPool) { document.getElementById('exPayer').value = e.payer; document.querySelectorAll('#modalSplit input').forEach(i => i.checked = e.splitWith.includes(i.value)); } }
  function editDeposit(id) { const d = state.poolDeposits.find(x => x.id == id); if (!d) return; openModal('DEPOSIT'); document.getElementById('exId').value = d.id; document.getElementById('exAmt').value = d.amt; document.getElementById('exCurr').value = d.curr; }
  function openDepositModal() { openModal('DEPOSIT'); }
  function closeModal() { document.getElementById('modal').classList.add('hidden'); }
  function togglePoolPayer(isP) { document.getElementById('personalPayerFields').style.display = isP ? 'none' : 'grid'; document.getElementById('exPayer').innerHTML = (state.members || []).map(m => `<option value="${m}">${m}</option>`).join(''); document.getElementById('modalSplit').innerHTML = (state.members || []).map(m => `<label class="flex items-center gap-2 p-2 bg-white rounded-xl"><input type="checkbox" value="${m}" checked> <span class="text-xs font-bold">${m}</span></label>`).join(''); }
  function saveRecord() { const amt = parseFloat(document.getElementById('exAmt').value); const curr = document.getElementById('exCurr').value; const date = document.getElementById('exDate').value; const eid = document.getElementById('exId').value; if (!amt) return; if (date === 'DEPOSIT') { if (eid) { const i = state.poolDeposits.findIndex(d => d.id == eid); state.poolDeposits[i] = { id: parseInt(eid), amt, curr }; } else state.poolDeposits.push({ id: Date.now(), amt, curr }); } else { const sw = Array.from(document.querySelectorAll('#modalSplit input:checked')).map(i => i.value); const rec = { id: eid ? parseInt(eid) : Date.now(), date, desc: document.getElementById('exDesc').value || 'Exp', amt, curr, payer: document.getElementById('exPayer').value, splitWith: sw, isPool: document.getElementById('usePool').checked }; if (eid) { const i = state.expenses.findIndex(e => e.id == eid); state.expenses[i] = rec; } else state.expenses.push(rec); } closeModal(); saveAll(); }
  function addNewTrip() { const newId = Date.now(); const nt = { id: newId, name: 'New Trip', members: [], expenses: [], poolDeposits: [], targetCurr: 'JPY', rateVal: 19.3 }; trips.push(nt); currentTripId = newId; localStorage.setItem('tripLedger_currentId', newId); dbPath.set(trips); }
  function deleteCurrentTrip() { if (trips.length <= 1) return; if (confirm("Delete this trip?")) { trips = trips.filter(t => t.id != currentTripId); currentTripId = trips[0].id; localStorage.setItem('tripLedger_currentId', currentTripId); dbPath.set(trips); } }
  function resetAllData() { if (confirm("ðŸš¨ DELETE ALL CLOUD DATA?")) { db.ref('tripLedgerData').set(null); window.location.reload(); } }
  async function handleCurrChange() { state.targetCurr = document.getElementById('targetCurr').value; await fetchLiveRate(); }
  async function fetchLiveRate() { try { const res = await fetch(`https://open.er-api.com/v6/latest/HKD`); const data = await res.json(); if (data && data.rates[state.targetCurr]) { document.getElementById('currentRateVal').value = parseFloat(data.rates[state.targetCurr].toFixed(4)); saveAll(); } } catch (e) {} }
  function addMember() { const n = prompt("Name?"); if(n) { state.members.push(n); saveAll(); } }
  function removeMember(n) { if(confirm(`Remove ${n}?`)) { state.members = state.members.filter(m => m !== n); saveAll(); } }
  function deleteExp(id) { state.expenses = state.expenses.filter(e => e.id != id); saveAll(); }
  function deleteDeposit(id) { state.poolDeposits = state.poolDeposits.filter(d => d.id != id); saveAll(); }
  function toggleSettled(id) { const e = state.expenses.find(x => x.id == id); if(e) e.settled = !e.settled; saveAll(); }
  function copySummary() { navigator.clipboard.writeText(document.getElementById('transferList').innerText); alert("Copied!"); }
</script>
</body>
</html>
